!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("prop-types"),require("react-dom"),require("ramda-extension"),require("react"),require("ramda")):"function"==typeof define&&define.amd?define(["exports","prop-types","react-dom","ramda-extension","react","ramda"],t):t((e=e||self).ReactUnion={},e.PropTypes,e.ReactDOM,e.R_,e.React,e.R)}(this,(function(e,t,r,n,o,i){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var a="default"in r?r.default:r,c="default"in o?o.default:o;var s=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e};function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var p={component:t.elementType.isRequired,path:t.string.isRequired},f={container:t.string,data:t.oneOfType([t.string,t.object]),namespace:t.string,widget:t.string.isRequired},d=function(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(r,!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},f,{component:t.elementType.isRequired,namespace:t.string.isRequired}),l=!!(process&&process.versions&&process.versions.node),m=!l,y="react-union/rescan",g="union",h=function(e,t,r){void 0===r&&(r="div");var n=document.getElementById(e);return n||function(e,t,r){var n=document.createElement(r),o=document.createAttribute("id");return o.value=e,n.setAttributeNode(o),t.appendChild(n),n}(e,t,r)};var v=o.createContext({data:void 0,namespace:void 0}),b=o.createContext({initialProps:void 0,widgetConfigs:void 0}),O=i.o(i.unary(JSON.parse),i.prop("innerHTML")),w=function(e){try{return O(e)}catch(t){return e.innerHTML.trim()?"INVALID_JSON":null}},S=i.applySpec({widget:i.path(["dataset","unionWidget"]),container:i.path(["dataset","unionContainer"]),namespace:i.path(["dataset","unionNamespace"]),data:w}),P=i.o(i.map(S),(function(e){return e.querySelectorAll("[data-union-widget]")})),j=i.applySpec({data:w}),E=i.o(i.map(j),(function(e){return e.querySelectorAll("[data-union-common]")})),_=Object.freeze({getWidgetDescriptors:P,getCommonDescriptors:E}),D=i.o(i.unary(JSON.parse),(function(e){return e.html()})),C=function(e){try{return D(e)}catch(t){return e.html().trim()?"INVALID_JSON":null}},N=i.applySpec({data:C}),x=l?Object.freeze({getWidgetDescriptors:function(e){return e("[data-union-widget]").map((function(t,r){return{widget:(n=e(r)).data("union-widget"),container:n.data("union-container"),namespace:n.data("union-namespace"),data:C(n)};var n})).get()},getCommonDescriptors:function(e){return e("[data-union-common]").map((function(t,r){return N(e(r))})).get()}}):_,I=i.applySpec({commonDescriptors:x.getCommonDescriptors,widgetDescriptors:x.getWidgetDescriptors}),T=function(e,t){if(!e){if(m)throw Error("An error occurred. Use a non-production build to see the details.");throw Error(t)}},R=function(e){return e.displayName||e.name||"Component"};function $(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var A=i.ifElse(i.contains("INVALID_JSON"),i.always("INVALID_JSON"),i.o(n.mergeDeepRightAll,n.rejectNil)),M=function(e,t){var r=function(e,t){return i.find(i.whereEq({path:t.widget}),e)}(e,t);return T(r,"Missing route for widget name "+t.widget+"."),r.component},q=i.curry((function(e,t,r){return function(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$(r,!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},r,{component:M(e,r),data:A([t,r.data]),namespace:r.namespace||r.container})})),L=i.o(A,i.map(i.prop("data"))),W=function(e,t){var r=t.widgetDescriptors,n=L(t.commonDescriptors);return T("INVALID_JSON"!==n,"Invalid JSON data encountered in a common descriptor. This is often due to a trailing comma or missing quotation marks."),{commonData:n,widgetConfigs:i.map(q(e,n),r),scanResult:t,routes:e}};function F(e,t){return e(t={exports:{}},t.exports),t.exports}var J,V=F((function(e){function t(){return e.exports=t=Object.assign||function(e){for(var t=1;arguments.length>t;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},t.apply(this,arguments)}e.exports=t})),z=F((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&Symbol.for,n=r?Symbol.for("react.element"):60103,o=r?Symbol.for("react.portal"):60106,i=r?Symbol.for("react.fragment"):60107,a=r?Symbol.for("react.strict_mode"):60108,c=r?Symbol.for("react.profiler"):60114,s=r?Symbol.for("react.provider"):60109,u=r?Symbol.for("react.context"):60110,p=r?Symbol.for("react.async_mode"):60111,f=r?Symbol.for("react.concurrent_mode"):60111,d=r?Symbol.for("react.forward_ref"):60112,l=r?Symbol.for("react.suspense"):60113,m=r?Symbol.for("react.suspense_list"):60120,y=r?Symbol.for("react.memo"):60115,g=r?Symbol.for("react.lazy"):60116,h=r?Symbol.for("react.fundamental"):60117,v=r?Symbol.for("react.responder"):60118;function b(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case p:case f:case i:case c:case a:case l:return e;default:switch(e=e&&e.$$typeof){case u:case d:case s:return e;default:return t}}case g:case y:case o:return t}}}function O(e){return b(e)===f}t.typeOf=b,t.AsyncMode=p,t.ConcurrentMode=f,t.ContextConsumer=u,t.ContextProvider=s,t.Element=n,t.ForwardRef=d,t.Fragment=i,t.Lazy=g,t.Memo=y,t.Portal=o,t.Profiler=c,t.StrictMode=a,t.Suspense=l,t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===i||e===f||e===c||e===a||e===l||e===m||"object"==typeof e&&null!==e&&(e.$$typeof===g||e.$$typeof===y||e.$$typeof===s||e.$$typeof===u||e.$$typeof===d||e.$$typeof===h||e.$$typeof===v)},t.isAsyncMode=function(e){return O(e)||b(e)===p},t.isConcurrentMode=O,t.isContextConsumer=function(e){return b(e)===u},t.isContextProvider=function(e){return b(e)===s},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},t.isForwardRef=function(e){return b(e)===d},t.isFragment=function(e){return b(e)===i},t.isLazy=function(e){return b(e)===g},t.isMemo=function(e){return b(e)===y},t.isPortal=function(e){return b(e)===o},t.isProfiler=function(e){return b(e)===c},t.isStrictMode=function(e){return b(e)===a},t.isSuspense=function(e){return b(e)===l}}));(J=z)&&J.__esModule&&Object.prototype.hasOwnProperty.call(J,"default");var H=F((function(e){e.exports=z})),U={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},k={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},B={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Y={};function G(e){return H.isMemo(e)?B:Y[e.$$typeof]||U}Y[H.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0};var K=Object.defineProperty,Q=Object.getOwnPropertyNames,X=Object.getOwnPropertySymbols,Z=Object.getOwnPropertyDescriptor,ee=Object.getPrototypeOf,te=Object.prototype;var re=function e(t,r,n){if("string"!=typeof r){if(te){var o=ee(r);o&&o!==te&&e(t,o,n)}var i=Q(r);X&&(i=i.concat(X(r)));for(var a=G(t),c=G(r),s=0;i.length>s;++s){var u=i[s];if(!(k[u]||n&&n[u]||c&&c[u]||a&&a[u])){var p=Z(r,u);try{K(t,u,p)}catch(e){}}}return t}return t};var ne,oe,ie=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t},ae=i.path(["props","config","widget"]),ce=(ne=v,oe="WidgetContext",function(e){var t=function(t){return c.createElement(ne.Consumer,null,(function(r){return c.createElement(e,V({},r,t))}))};return re(t,e),t.displayName="With"+oe+"("+R(e)+")",t}),se=function(e){return!l&&window.__INITIAL_PROPS__&&window.__INITIAL_PROPS__[e.config.namespace]},ue=i.memoizeWith(i.prop("id"),(function(e){return e.innerHTML=""})),pe=function(e){function t(t,r){var o;return(o=e.call(this,t,r)||this).getInitialProps=function(e){var t=o.props.config;n.isFunction(e.getInitialProps)&&e.getInitialProps(t).then((function(e){return o.setState({initialProps:e})}))},o.state={initialProps:t.initialProps||se(t)||null},o}ie(t,e);var o=t.prototype;return o.componentDidMount=function(){if(!this.state.initialProps){var e=this.props.config.component;if(n.isFunction(e.preload))return e.preload().then(this.getInitialProps);this.getInitialProps(e)}},o.render=function(){var e=this.props.config,t=this.state.initialProps,n=e.component,o=e.container,i=e.data,a=e.namespace,s=e.widget;T("INVALID_JSON"!==i,'Invalid JSON data encountered while attempting to render widget "'+s+'". This is often due to a trailing comma or missing quotation marks.');var u={data:i,namespace:a},p=c.createElement(v.Provider,{value:u},c.createElement(n,V({},u,t)));if(l)return c.createElement("div",{"data-union-portal":o},p);var f=document.getElementById(o);return T(f,'HTML element with ID "'+o+'" not found for widget "'+s+'".'),ue(f),r.createPortal(p,f)},t}(o.Component);pe.propTypes={config:t.shape(d).isRequired,initialProps:t.object};var fe,de,le=(fe=pe,(de=function(e){function t(){for(var t,r=arguments.length,n=Array(r),o=0;r>o;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).state={hasError:!1},t}ie(t,e);var r=t.prototype;return r.componentDidCatch=function(){this.setState({hasError:!0})},r.render=function(){var e=this.state.hasError,t=ae(this);return e?c.createElement("div",null,'An error has occurred in widget "'+t+'". See the console for more details. To\n\t\t\t\t\t\tavoid seeing this message in production, wrap this widget in an error boundary.'):c.createElement(fe,this.props)},t}(o.Component)).displayName="WithErrorBoundary("+R(fe)+")",de.propTypes={config:t.shape(d).isRequired},de),me=function(e){function t(r,n){var o;return(o=e.call(this,r,n)||this).rescan=function(){return o.setState({widgetConfigs:t.scan(o.props)})},o.renderWidget=function(e){return c.createElement(le,{config:e,initialProps:i.path([e.namespace],(o.context||{}).initialProps),key:e.namespace})},o.state={routesReference:r.routes,widgetConfigs:(o.context||{}).widgetConfigs||t.scan(r)},o}ie(t,e),t.getDerivedStateFromProps=function(e,r){return r.routesReference!==e.routes?{routesReference:e.routes,widgetConfigs:t.scan(e)}:null};var r=t.prototype;return r.componentDidMount=function(){document.addEventListener(y,this.rescan)},r.componentWillUnmount=function(){document.removeEventListener(y,this.rescan)},r.render=function(){return c.createElement(o.Fragment,null,this.props.children,i.map(this.renderWidget,this.state.widgetConfigs))},t}(o.Component);me.scan=function(e){var t=e.onScanStart,r=e.onScanEnd,n=e.onScanError,o=e.parent,i=e.routes;T(i,"Missing `routes` prop in <Union />.");try{t();var a=I(o),c=W(i,a);return r(c),c.widgetConfigs}catch(e){throw n(e),e}},me.propTypes={children:t.node,onScanEnd:t.func,onScanError:t.func,onScanStart:t.func,parent:t.oneOfType([t.object,t.func]),routes:t.arrayOf(t.shape(p))},me.defaultProps={onScanEnd:n.noop,onScanError:n.noop,onScanStart:n.noop,parent:l?null:document},me.contextType=b,e.PrescanContext=b,e.RouteShape=p,e.Union=me,e.WidgetConfigShape=d,e.WidgetContext=v,e.WidgetDescriptorShape=f,e.justRender=function(e,t,r){void 0===t&&(t=g),void 0===r&&(r=n.noop);var o=h(t,document.body);window.__HYDRATE__&&(delete window.__HYDRATE__,a.render(e,o,r)),a.render(e,o,r)},e.justUnmountComponentAtNode=function(e){void 0===e&&(e=g);var t=document.getElementById(e);a.unmountComponentAtNode(t)},e.rescan=function(){var e=document.createEvent("Event");e.initEvent(y,!0,!0),document.dispatchEvent(e)},e.route=W,e.scan=I,e.withWidgetContext=ce,Object.defineProperty(e,"__esModule",{value:!0})}));
